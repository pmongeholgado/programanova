<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Generador de Presentaciones Â· Nova</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #0c0f17;
                color: #e5e7eb;
                margin: 0;
                padding: 24px;
            }

            h1 {
                text-align: center;
                color: #5ddcff;
            }

            .box {
                max-width: 640px;
                margin: auto;
                background: rgba(255,255,255,0.04);
                border: 1px solid rgba(255,255,255,0.1);
                padding: 24px;
                border-radius: 12px;
            }

            label {
                font-weight: bold;
            }

            input, textarea, select {
                width: 100%;
                padding: 12px;
                margin-top: 8px;
                margin-bottom: 16px;
                border-radius: 8px;
                border: none;
            }

            button {
                width: 100%;
                padding: 14px;
                background: linear-gradient(90deg, #1e90ff, #00c2ff);
                border: none;
                border-radius: 8px;
                color: white;
                font-size: 18px;
                cursor: pointer;
            }

            button:hover {
                background: linear-gradient(90deg, #00c2ff, #1e90ff);
            }

            .estado {
                text-align: center;
                margin-top: 20px;
                color: #7dd3fc;
                font-weight: bold;
            }

        #resultado {
            margin-top: 24px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.12);
            padding: 16px;
            border-radius: 10px;
        }

        #resultado h3 {
            color: #5ddcff;
            margin-bottom: 12px;
            text-align: center;
        }

        #resultado ul {
            padding-left: 20px;
        }

        #resultado li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
    </style>
</head>

<body>

<h1>Generador Nova Â· Presentaciones</h1>

<div class="box">
    <label>TÃ­tulo de la presentaciÃ³n</label>
    <input type="text" id="titulo" placeholder="Ejemplo: InnovaciÃ³n y futuro de la colaboraciÃ³n humano-IA" />

    <label>NÃºmero de diapositivas</label>
    <select id="slides">
        <option value="10">10 diapositivas</option>
        <option value="12">12 diapositivas</option>
        <option value="15">15 diapositivas</option>
        <option value="20">20 diapositivas</option>
    </select>

    <label>Contenido base (capÃ­tulo, texto o guion)</label>
    <textarea id="contenido" rows="6" placeholder="Pega aquÃ­ tu capÃ­tulo, texto o guion baseâ€¦"></textarea>

    <button onclick="generar()">Generar estructura de presentaciÃ³n</button>
    <button id="btnPPT" onclick="exportarPPT()" disabled>ðŸ“¤ Exportar a PPT</button>
    <button onclick="exportarPPT()">ðŸ“Š Exportar a PowerPoint</button>

    <div class="estado" id="estado">ðŸŸ¢ Generador listo</div>
    <div id="resultado" style="margin-top:20px;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    
<script>
let estructuraGenerada = [];
    
const API_BASE_URL = "https://programanovabackend-production.up.railway.app";

async function generar() {
    const tituloEl = document.getElementById("titulo");
    const slidesEl = document.getElementById("slides");
    const contenidoEl = document.getElementById("contenido");
    const estadoEl = document.getElementById("estado");

    const titulo = (tituloEl.value || "").trim();
    const numDiapositivas = slidesEl.value;
    const contenido = (contenidoEl.value || "").trim();

    if (!contenido) {
        estadoEl.innerText = "âš ï¸ Introduce un texto base antes de generar la presentaciÃ³n.";
        return;
    }

    estadoEl.innerText = "â³ Procesando solicitudâ€¦";

    try {
        const response = await fetch(`${API_BASE_URL}/generar`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                titulo,
                num_diapositivas: numDiapositivas,
                contenido,
            }),
            mode: "cors",
        });

        if (!response.ok) {
            estadoEl.innerText = "âŒ Error al procesar la solicitud.";
            return;
        }

        const data = await response.json().catch(() => ({}));

        estadoEl.innerText =
            data.mensaje ||
            "âœ… Solicitud recibida correctamente. Preparando generaciÃ³n avanzada.";
        const resultadoEl = document.getElementById("resultado");

        if (Array.isArray(data.estructura)) {
            estructuraGenerada = data.estructura;

            document.getElementById("btnPPT").disabled = false;
            
            resultadoEl.innerHTML = `
                <h3>Estructura generada</h3>
                <ul>
                    ${data.estructura.map(item => `<li>${item}</li>`).join("")}
                </ul>
            `;
        }
    } catch (err) {
        estadoEl.innerText = "âŒ No se pudo conectar con el servicio.";
    }
}
function exportarPPT() {
    if (!estructuraGenerada.length) {
        alert("Primero genera una presentaciÃ³n.");
        return;
    }

    const pptx = new PptxGenJS();

    estructuraGenerada.forEach((item, index) => {
        const slide = pptx.addSlide();
        slide.addText(`Diapositiva ${index + 1}`, {
            x: 0.5, y: 0.5, fontSize: 18, bold: true
        });
        slide.addText(item, {
            x: 0.5, y: 1.5, fontSize: 14, wrap: true
        });
    });

    pptx.writeFile("Nova_Presentacion.pptx");
}
    
</script>

</body>
</html>
